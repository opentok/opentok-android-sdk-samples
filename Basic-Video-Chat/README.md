# Basic Video Chat

This application provides a completed version of the OpenTok [Basic Video Chat tutorial](https://tokbox.com/developer/tutorials/android/) for Android (differing only in some additional validation checks). Upon deploying this sample application, you should be able to have two-way audio and video communication using OpenTok.

Main features:
* Connect to an OpenTok session
* Publish an audio-video stream to the session
* Subscribe to another client's audio-video stream

# Configure the app 
Open the `OpenTokConfig` file and configure the `API_KEY`, `SESSION_ID`, and `TOKEN` variables. You can obtain these values from your [TokBox account](https://tokbox.com/account/#/).
### (Optional) Deploy a back end web service

 For a production application, the `SESSION_ID` and `TOKEN` values must be generated by your app server application and passed to the client. Here are a couple of reasons why you don't want hard coded credentials in your production app:
- Tokens expire after a certain amount of time (specified when generated), so new ones need to be generated regularly
- You won't be able to create new sessions dynamically, so everyone using your app would be stuck in a single "room"

To simplify setup, you can qickly deploy a pre-built server that we've provided ([learning-opentok-php](https://github.com/opentok/learning-opentok-php)). To launch the server, simply click the Heroku button below, at which point you'll be sent to Heroku's website and prompted for your OpenTok API Key and API Secret â€” you can get these values on your project page in your [TokBox account](https://tokbox.com/account/user/signup). If you don't have a Heroku account, you'll need to sign up (it's free).

<a href="https://heroku.com/deploy?template=https://github.com/opentok/learning-opentok-php" target="_blank">
  <img src="https://www.herokucdn.com/deploy/button.png" alt="Deploy">
</a>

After deployng the server open the `ServerConfig.java` file in this project and configure the `CHAT_SERVER_URL` with `https://YOURAPPNAME.herokuapp.com` to fetch credentials from the server.

```java
private void getSession() {
    Log.i(TAG, "getSession");

    Call<GetSessionResponse> call = apiService.getSession();

    call.enqueue(new Callback<GetSessionResponse>() {
        @Override
        public void onResponse(Call<GetSessionResponse> call, Response<GetSessionResponse> response) {
            GetSessionResponse body = response.body();
            initializeSession(body.apiKey, body.sessionId, body.token);
        }

        @Override
        public void onFailure(Call<GetSessionResponse> call, Throwable t) {
            throw new RuntimeException(t.getMessage());
        }
    });
}
```

Notice that application will ignore credentials in the `OpenTokConfig` file when `CHAT_SERVER_URL` contains a valid URL:

```java
if (ServerConfig.hasChatServerUrl()) {
    // Custom server URL exists - retrieve session config
    if(!ServerConfig.isValid()) {
        finishWithMessage("Invalid chat server url: " + ServerConfig.CHAT_SERVER_URL);
        return;
    }

    initRetrofit();
    getSession();
} else {
    // Use hardcoded session config
    if(!OpenTokConfig.isValid()) {
        finishWithMessage("Invalid OpenTokConfig. " + OpenTokConfig.getDescription());
        return;
    }

    initializeSession(OpenTokConfig.API_KEY, OpenTokConfig.SESSION_ID, OpenTokConfig.TOKEN);
}
```

## Further Reading

* Review [other sample projects](../)
* Read more about [OpenTok Android SDK](https://tokbox.com/developer/sdks/android/)
